## Основной функционал

[Перейти к документации (Swagger UI)](https://shortlink-312j.onrender.com/docs)

---

### Аутентификация и авторизация

- Регистрация пользователей (`POST /register`)
- Авторизация с получением JWT токена (`POST /login`)
- Доступ к защищённым маршрутам осуществляется по токену (формат: `Bearer <token>`)

> Чтобы авторизоваться:
> 1. Выполните `POST /login`, получите `access_token`
> 2. Нажмите **Authorize** в Swagger UI
> 3. Вставьте токен в формате:
>    ```
>    Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
>    ```

---

### Работа с короткими ссылками

- Создание короткой ссылки (`POST /links/shorten`)  
  Поддерживает:
  - оригинальный URL (`original_url`)
  - срок действия (`expires_at`)
  - кастомный alias (`custom_alias`)

> Даже неавторизованные пользователи могут создать ссылку без входа
> 
> Вы можете не заполнять alias система сама придумает ссылку

- Редирект по короткому URL  
  Открытый доступ:
  ```
  https://shortlink-312j.onrender.com/myalias
  ```

- Обновление ссылки (`PUT /links/{short_code}`)  
  Только для авторизованных пользователей

- Удаление ссылки вручную (`DELETE /links/{short_code}`)  
  Только для владельца

- Автоматическое удаление просроченных ссылок  
  - Если срок действия истёк — ссылка не открывается  
  - Может быть удалена при следующем обращении

- Раз в неделю автоматически удаляются неиспользуемые ссылки  
  (если срок действия истёк и не было переходов)

---

### Получение статистики

- `GET /links/{short_code}/stats`
- Доступно только авторизованным владельцам

Возвращает:
- оригинальный URL
- дату создания
- дату последнего перехода

---

### Работа с пользователями

- Привязка ссылок к аккаунту владельца
- Получение всех своих ссылок (`GET /user/links`)

---

### Гостевой режим

- Создание и открытие ссылок — без регистрации
- Управление, удаление, статистика — только для авторизованных пользователей

## Структура базы данных

База данных построена на PostgreSQL, используется SQLAlchemy + asyncpg.

---

### Таблица `users`

Хранит зарегистрированных пользователей.

| Поле             | Тип        | Описание                                   |
|------------------|------------|--------------------------------------------|
| `id`             | INTEGER    | Уникальный ID (Primary Key)                |
| `email`          | VARCHAR    | Уникальный логин/почта пользователя        |
| `hashed_password`| VARCHAR    | Хэшированный пароль                        |

Пользователи могут:
- создавать, удалять и обновлять свои ссылки;
- просматривать статистику по ним.

---

### Таблица `shortened_links`

Хранит все созданные короткие ссылки, включая ссылки от гостей (неавторизованных пользователей).

| Поле            | Тип         | Описание                                          |
|------------------|-------------|---------------------------------------------------|
| `id`             | INTEGER     | Уникальный ID (Primary Key)                       |
| `original_url`   | VARCHAR     | Исходный URL                                      |
| `short_code`     | VARCHAR(50) | Уникальный код короткой ссылки                    |
| `created_at`     | TIMESTAMP   | Дата создания                                     |
| `expires_at`     | TIMESTAMP   | Срок действия ссылки                              |
| `click_count`    | INTEGER     | Количество переходов                             |
| `last_used_at`   | TIMESTAMP   | Дата последнего перехода по ссылке               |
| `user_id`        | INTEGER (FK)| ID пользователя (если есть, может быть NULL)     |

#### Особенности:
- `short_code` — уникальный для каждой ссылки
- `expires_at` — если указан и истёк, ссылка считается неактивной
- `click_count` и `last_used_at` обновляются автоматически при переходах
- `user_id` — может быть `NULL`, если ссылка создана анонимно
